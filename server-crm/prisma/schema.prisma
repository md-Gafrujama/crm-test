// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id              String   @id @default(auto()) @map("_id") @db.ObjectId
  firstName       String
  lastName        String
  username        String   @unique
  email           String   @unique
  hashedPassword  String
  phoneNumber     String?
  role            String
  userType        String?
  photo           String?
  assignedWork    String?
  statusOfWork    String?  @default("inactive")
  statusOfAccount String?
  locked          Boolean  @default(false)
  loggedInTime    DateTime?
  lastLoggedIn    DateTime?
  about           String?
  skills          String[]
  lockedAt        DateTime?
  googleAccessToken  String?
  googleRefreshToken String?
  googleExpiryDate   Int? 
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  companyId       String   @db.ObjectId
  company         company  @relation("CompanyUsers", fields: [companyId], references: [id])

  otps            OTP[]
}

model superAdmin{
  id              String   @id @default(auto()) @map("_id") @db.ObjectId
  firstName String
  lastName String
  username String @unique
  phone String  @unique
  email String @unique
  password String
  role String @default("superAdmin")
}

model OTP {
  id              String   @id @default(auto()) @map("_id") @db.ObjectId
  email           String   
  genOTP          String   
  givenOTP        String[] 
  attempts        Int      
  statusOfAccount String?
  createdAt       DateTime @default(now())
  expiresAt       DateTime

  user            User?    @relation(fields: [email], references: [email], onDelete: Cascade)
}

model Employee {
  id             String   @id @default(auto()) @map("_id") @db.ObjectId
  firstName      String
  lastName       String
  username       String   @unique
  email          String   @unique
  phoneNumber    String   @unique
  whatsAppPhone  String?  
  joiningDate    DateTime
  status         String   
  department     String
  role           String
  photo          String?  

  companyId      String   @db.ObjectId
  company        company  @relation("CompanyEmployees", fields: [companyId], references: [id])

  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}

model company {
  id             String   @id @default(auto()) @map("_id") @db.ObjectId
  owners_firstName String 
  owners_lastName  String
  username       String

  companyName    String   @unique
  companyType    String   @unique  
  
  email          String   @unique
  phone          String
  hashedPassword String

  agreeToterms   Boolean  @default(false)
  status         String @default("Pending")
  noOfUsers      Int      @default(0)
  profileImage   String
  subscription   Boolean @default(false)

  // Google Analytics Integration
  gaPropertyId   String?
  gaAccessToken  String?
  gaRefreshToken String?
  gaTokenExpiry  DateTime?

  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  
  users          User[]               @relation("CompanyUsers")
  employees      Employee[]           @relation("CompanyEmployees")
  leads          Lead[]               @relation("CompanyLeads")
  alerts         Alertsandremainder[] @relation("CompanyAlerts")
}

model Lead {
  id                  String   @id @default(auto()) @map("_id") @db.ObjectId
  uid                 String
  companyId           String   @db.ObjectId
  company             company  @relation("CompanyLeads", fields: [companyId], references: [id])
  title               String
  username            String?
  customerFirstName   String
  customerLastName    String
  emailAddress        String
  phoneNumber         String
  companyName         String
  jobTitle            String
  topicOfWork         String
  industry            String
  status              String
  serviceInterestedIn String
  closingDate         DateTime
  notes               String?
  rootId              String?   
  versionNumber       Int      @default(1)
  isCurrentVersion    Boolean  @default(true)
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
}

model Alertsandremainder {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  uid         String
  companyId   String   @db.ObjectId
  company     company  @relation("CompanyAlerts", fields: [companyId], references: [id])
  topic       String
  remainder   String
  date        DateTime
  time        String
  description String
}

model Qb2b{
  id String @id @default(auto()) @map("_id") @db.ObjectId
  customerName String
  customerEmail String
  customerNumber String
  comment String
}

model compare{
  id String @id @default(auto()) @map("_id") @db.ObjectId
  firstName String
  lastName String
  comment String
}

model qb2bLeads{
  id String @id @default(auto()) @map("_id") @db.ObjectId
  customerName String
  emailAddress String
  phoneNumber  String
  serviceInterestedIn String
  needs     String
  promotion String
  createdAt DateTime @default(now())
}

model Calendar {
  id               String    @id @default(auto()) @map("_id") @db.ObjectId
  uid              String    
  companyId        String    @db.ObjectId
  googleEventId    String? 
  eventTopic       String
  eventDate        DateTime
  startTime        DateTime?
  endTime          DateTime?
  meetingType      MeetingType?   
  description      String?
  eventPurpose     EventPurpose
  hangoutLink      String?      
  googleEventLink  String?    
  createdBy        String?    @db.ObjectId
  createdAt        DateTime   @default(now())
  updatedBy        String?    @db.ObjectId
  updatedAt        DateTime   @updatedAt

  @@index([companyId, eventDate])
}

enum MeetingType {
  IN_PERSON
  ONLINE
  HYBRID
  OFFLINE
}

enum EventPurpose {
  MEETING
  TRAINING
  WORKSHOP
  WEBINAR
  OTHER
}

model PageTimeEvent {
  id         String   @id @default(auto()) @map("_id") @db.ObjectId

  companyId  String   @db.ObjectId
  userId     String?  @db.ObjectId

  page       String
  durationMs Int
  deviceType String?
  ip         String?
  userAgent  String?
  timestamp  DateTime @default(now())

  @@index([companyId, timestamp])
  @@index([companyId, userId, timestamp])
  @@index([companyId, deviceType, timestamp])
  @@index([companyId, page, timestamp])
}